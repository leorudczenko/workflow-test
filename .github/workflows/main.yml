name: Create distributable files

on:
  release:
    types:
      - released

jobs:
#   build-windows:
#     runs-on: windows-latest
#     steps:
#     - uses: actions/checkout@v3

#     - name: Create Anaconda Environment
#       uses: conda-incubator/setup-miniconda@v2
#       with:
#         activate-environment: tactool
#         environment-file: environment.yml
#         python-version: 3.11
#         auto-activate-base: false

#     - name: Build with PyInstaller
#       shell: bash -l {0}
#       run: pyinstaller --name=hello-world --windowed --paths=. --onefile app/main.py

#     - name: Get Latest Release Info
#       id: latest_release_info
#       uses: jossef/action-latest-release-info@v1.2.1
#       env:
#         GITHUB_TOKEN: ${{ github.token }}

#     - name: Add Asset to Latest Release
#       uses: actions/upload-release-asset@v1
#       env:
#         GITHUB_TOKEN: ${{ github.token }}
#       with:
#         upload_url: ${{ steps.latest_release_info.outputs.upload_url }}
#         asset_path: dist/hello-world.exe
#         asset_name: hello-world_${{ steps.latest_release_info.outputs.tag_name }}.exe
#         asset_content_type: application

  build-macos:
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v3

      - name: Create Anaconda Environment
        uses: conda-incubator/setup-miniconda@v2
        with:
          activate-environment: macos
          python-version: 3.11
          auto-activate-base: false
      - name: Install packages
        shell: bash -l {0}
        run: |
          pip install pyinstaller pyqt5 pytest flake8
          conda env export > macos-environment.yml

      - name: Get Latest Release Info
        id: latest_release_info
        uses: jossef/action-latest-release-info@v1.2.1
        env:
          GITHUB_TOKEN: ${{ github.token }}

      - name: Add Asset to Latest Release
        uses: actions/upload-release-asset@v1
        env:
          GITHUB_TOKEN: ${{ github.token }}
        with:
          upload_url: ${{ steps.latest_release_info.outputs.upload_url }}
          asset_path: macos-environment.yml
          asset_name: macos-environment.yml
          asset_content_type: application



      # - name: Build with PyInstaller
      #   shell: bash -l {0}
      #   run: pyinstaller --name=hello-world --windowed --paths=. --onefile app/main.py

      # - name: Get Latest Release Info
      #   id: latest_release_info
      #   uses: jossef/action-latest-release-info@v1.2.1
      #   env:
      #     GITHUB_TOKEN: ${{ github.token }}

      # - name: Add Asset to Latest Release
      #   uses: actions/upload-release-asset@v1
      #   env:
      #     GITHUB_TOKEN: ${{ github.token }}
      #   with:
      #     upload_url: ${{ steps.latest_release_info.outputs.upload_url }}
      #     asset_path: dist/hello-world.app
      #     asset_name: hello-world.app
      #     asset_content_type: application
